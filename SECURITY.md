# セキュリティポリシー

## サポートされているバージョン

| バージョン | サポート状況 |
| ------- | ------------------ |
| 2.0.x   | :white_check_mark: |
| 1.0.x   | :x:                |

## 脆弱性の報告

このプロジェクトのセキュリティ脆弱性を発見した場合は、以下の手順で報告してください：

1. **公開しない**: GitHubのIssueには脆弱性の詳細を投稿しないでください
2. **プライベート連絡**: メンテナーに直接連絡するか、GitHubのSecurity Advisoriesを使用してください
3. **詳細情報の提供**:
   - 脆弱性の種類
   - 影響を受けるファイル/機能
   - 再現手順
   - 可能であればPoCコード
   - 推奨される修正方法

## セキュリティ対策

### 実装済みのセキュリティ機能

- ✅ コマンドインジェクション防止（execFile使用）
- ✅ パストラバーサル攻撃防止
- ✅ XSS防止（HTMLエスケープ）
- ✅ 入力検証フレームワーク
- ✅ エラーメッセージのサニタイズ
- ✅ サンドボックス化されたエージェント実行
- ✅ 機密情報の自動マスキング
- ✅ Windows管理者権限チェック

### 自動セキュリティ監査

- 📅 **依存関係監査**: Dependabotによる毎日の監査
- 🔍 **CodeQL分析**: 毎週の自動スキャン
- 🛡️ **ESLintセキュリティ**: プッシュごとの検証
- 📊 **機密情報検出**: CI/CDパイプラインでの自動検出

### 既知の制限事項

- エージェント実行時のリソース制限（10MB/ファイル）
- 並列実行数の制限（最大4プロセス）
- 管理者権限が必要な場合の制限

## セキュリティベストプラクティス

### 環境設定

1. **環境変数の使用**
   ```bash
   # .envファイルを使用して機密情報を管理
   cp .env.example .env
   # 実際の値を設定（.envはgitignore済み）
   ```

2. **最小権限の原則**
   - 必要最小限の権限でプロセスを実行
   - 管理者権限は必要な場合のみ使用

3. **定期的な更新**
   ```bash
   # セキュリティ監査の実行
   npm run security-audit
   
   # 依存関係の更新
   npm run security-fix
   ```

### コード実行時の注意

- 信頼できないソースからの入力を処理しない
- 出力ディレクトリを制限する
- ログに機密情報を出力しない
- 設定ファイルの検証を行う

## CI/CDセキュリティ

### 自動化されたチェック

1. **毎回のプッシュ**:
   - ESLintセキュリティルールの実行
   - 機密情報の検出
   - ファイル権限チェック

2. **毎日の監査**:
   - npm auditの実行
   - 依存関係の脆弱性チェック

3. **毎週のスキャン**:
   - CodeQLによる静的解析
   - 実験的セキュリティクエリの実行

### セキュリティワークフロー

```bash
# 開発者向け事前チェック
npm run pre-commit

# 手動セキュリティチェック
npm run security-audit
npm run validate-config
```

## 責任ある開示

私たちは責任ある開示の原則に従います：

1. **初回応答**: 報告から48時間以内
2. **修正計画**: 7日以内に共有
3. **修正リリース**: 30日以内（重大度による）
4. **公開**: 修正後にセキュリティアドバイザリを公開

## 連絡先

セキュリティに関する問い合わせ：
- 🔒 **機密度高**: GitHub Security Advisoriesを使用
- 📧 **一般的な報告**: セキュリティIssueテンプレートを使用
- 💬 **質問**: GitHub Discussionsを使用

## セキュリティリソース

### 開発者向け

- [CONTRIBUTING.md](./CONTRIBUTING.md#-セキュリティに関する貢献) - セキュリティを考慮した開発ガイド
- [ESLint設定](./.eslintrc.js) - セキュリティルールの詳細
- [GitHub Actions](./.github/workflows/) - CI/CDセキュリティ設定

### 利用者向け

- [インストールガイド](./README.md#インストール) - 安全なセットアップ手順
- [設定ガイド](./Smart-Review-SystemGuide.md) - セキュアな運用方法
- [トラブルシューティング](./README.md#トラブルシューティング) - セキュリティ関連問題の解決

## 謝辞

セキュリティ向上に貢献してくださった方々に感謝します：
- セキュリティ研究者の皆様
- コミュニティの貢献者
- 責任ある開示を行ってくださった報告者
